{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Font Awesome -->

    <!-- meta tags store general metadata -->
    {% comment %} https://developer.mozilla.org/en-US/docs/Web/HTML/Element#document_metadata {% endcomment %}
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Get our favorite font. -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,300;0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">

    <!-- Get our favicon. -->

    <!-- Import external css -->
    <!-- 'normalize css first' -->
    <link rel="stylesheet" type="text/css" href="https://necolas.github.io/normalize.css/8.0.1/normalize.css" />
    <!-- Import external css -->
    <!-- Specify our css -->
    {% comment %} <link rel="stylesheet" type="text/css" href="/static/css/style.css" />     {% endcomment %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}" />

    <!-- Page title, the text that appears on a browser. -->
    <title>{% block title %}Technology and Perceptibility{% endblock %}</title>

    <style></style>

</head>
<body class="wrapper">
    {% csrf_token %}
    
    <div class="full-width-header">
        <header>
            <a href="#all-the-taps" title="Skip to main content">Skip to main content</a>
            <div class="page-title">
                <h1>TAP - Accessibility in Action</h1>
                
            </div>
            <nav>
                <p><a href="{% url 'home' %}">Home</a></p>
                <p><a href="#">Our Values</a></p>
                <address>
                    <a href="mailto:Bruce.Stull@gmail.com">Bruce.Stull@gmail.com</a><br>
                    <a href="https://brucestull.com/" target="_blank">brucestull.com</a>
                </address>
            </nav>
        </header>
    </div>
    <main class="page-body">
        <div id="app" class="div-replacing-main">
        {% block content %}
        {% endblock %}
        </div>
    </main>
    <footer class="page-footer">
        <p>Flynnt Knapp 2022</p>
        <p><a href="{% url 'home' %}">Home</a></p>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script>
        const vm = new Vue({
            el: '#app',
            delimiters: ['[[',']]'],
            data: {

                newAuthor: 1,
                newTitle: '',
                newUrl: '',
                newUrlLabel: '',
                newDescription: '',

                tempTap: {
                    id: '',
                },

                taps: [],

                currentTap: {},

                editingCurrentTap: {},
                temporaryTapTitle: '',

                // tapFromApi: {
                //     "id": 10,
                //     "title": "A new Title",
                //     "author": 1,
                //     "author_detail": {
                //         "id": 1,
                //         "username": "admin"
                //     },
                //     "url": "",
                //     "url_label": "URL Label",
                //     "description": "The extended description"
                // },

                csrf_token: '',

                editTitle: false,
                editDescription: false,
                editUrlLabel: false,

            },

            methods: {
                loadTaps: function() {
                    console.log("Attempting to load TAPs")
                    axios({
                        method: 'get',
                        url: `/api/v1/taps/`,
                    }).then(response => {
                        console.log(`response: `, response)
                        console.log(`response.data: `, response.data)
                        for (let i = 0; i < response.data.length; i++) {
                            this.taps.push(response.data[i])
                            this.taps[i].localBrowsableApiUrl = `/api/v1/taps/${this.taps[i].id}/`
                            this.taps[i].localBrowsableApiUrlDescription = `Browsable API link to this TAP with id of ${this.taps[i].id}.`
                        }
                        console.log(`this.taps`, this.taps)
                        this.clearCurrentTap()
                    }).catch(error => {
                        console.log(`error.response.data`, error.response.data)
                    })
                },

                clearTaps: function() {
                    this.taps = []
                },

                loadSingleTap: function(tap) {
                    this.clearAllTaps()
                    this.setEditFlagsFalse()
                    console.log(`Attempting to load a single TAP: ${ tap.id }`)
                    axios({
                        method: 'get',
                        url: `/api/v1/taps/${ tap.id }/`,
                    }).then(response => {
                        console.log(`response: `, response)
                        console.log(`response.data: `, response.data)
                        this.currentTap = response.data

                        this.currentTap.localBrowsableApiUrl = `/api/v1/taps/${ this.currentTap.id }/`
                        this.currentTap.localBrowsableApiUrlDescription = `Browsable API link to this TAP with id of ${ this.currentTap.id }.`

                        console.log(`currentTap: `, this.currentTap)
                        console.log(`currentTap.id: `, this.currentTap.id)
                        console.log(`currentTap.title: `, this.currentTap.title)
                    }).catch(error => {
                        // console.log(`error.response.data`, error.response.data)
                        console.log(`error`, error)
                        console.log(`error.response`, error.response)
                    })
                },

                clearCurrentTap: function() {
                    this.currentTap = {}
                },

                editTap: function() {

                    console.log(`Editing this.currentTap - #${this.currentTap}: `, this.currentTap)
                    console.log(`Editing this.editingCurrentTap - #${this.editingCurrentTap}: `, this.editingCurrentTap)

                    this.editingCurrentTap = this.currentTap
                    this.temporaryTapTitle = this.currentTap.title
                    this.clearCurrentTap()

                    console.log(`Cleared this.currentTap - #${this.currentTap}: `, this.currentTap)
                    console.log(`Editing this.editingCurrentTap - #${this.editingCurrentTap}: `, this.editingCurrentTap)

                },

                // editTap: function(tap) {
                //     this.editingCurrentTap = tap
                //     this.temporaryTapTitle = tap.title
                //     console.log(`Editing tap #${ tap.id }: `, tap)
                //     this.clearCurrentTap()
                // },

                clearEditingCurrentTap: function() {
                    this.editingCurrentTap = {}
                },

                saveTap: function() {
                    console.log(`Saving tap #${ this.editingCurrentTap.id}: `, this.editingCurrentTap)
                    axios({
                        method: 'patch',
                        url: `/api/v1/taps/${ this.editingCurrentTap.id }/`,
                        headers: {
                            "X-CSRFToken": this.csrf_token
                        },
                        data: {
                            "title": this.editingCurrentTap.title,
                            "url_label" : this.editingCurrentTap.url_label,
                            "description": this.editingCurrentTap.description,
                        }
                    }).then(response => {
                        console.log(response)
                        this.loadSingleTap(this.editingCurrentTap)
                    }).catch(error => {
                        console.log(error.response)
                    })
                },

                createNewTap: function() {
                    
                    /////////////////////////////////////////////////////////
                    // This part here for testing only, using it to quickly create TAPs. Will remove in production.
                    this.newAuthor = 1
                    this.newTitle = 'A Possibly New Title'
                    this.newUrl = 'https://brucestull.com/'
                    this.newUrlLabel = 'Well, Why not another URL Label, TOO!'
                    this.newDescription = "And we can't forget the description"
                    /////////////////////////////////////////////////////////

                    console.log(`Creating the new TAP!`)
                    console.log(`New TAP Title: `, this.newTitle)
                    console.log(`New TAP URL: `, this.newUrl)
                    console.log(`New TAP Descr: `, this.newDescription)

                    axios({
                        method: 'post',
                        url: `/api/v1/taps/`,
                        headers: {
                            "X-CSRFToken": this.csrf_token
                        },
                        data: {
                            "author": 1,
                            "title": this.newTitle,
                            "url": this.newUrl,
                            "url_label" : this.newUrlLabel,
                            "description": this.newDescription,
                        }
                    }).then(response => {
                        console.log(response)
                        console.log(`response.data.id: `, response.data.id)
                        this.tempTap.id = response.data.id
                        this.loadSingleTap(this.tempTap)
                        
                    this.newAuthor = ''
                    this.newTitle = ''
                    this.newUrl = ''
                    this.newUrlLabel = ''
                    this.newDescription = ''

                    }).catch(error => {
                        console.log(error.response)
                    })
                },

                deleteTap: function(payload) {
                    console.log(`Deleting Tap #${payload.id}`, payload)
                    axios({
                        method: 'delete',
                        url: `/api/v1/taps/${ payload.id }/`,
                        headers: {
                            "X-CSRFToken": this.csrf_token
                        }
                    }).then(response => {
                        console.log(`Did we delete something???`, response)
                        this.loadTaps()
                    }).catch(error => {
                        console.log(error.response)
                    })
                },

                clearAllTaps: function() {
                    this.clearTaps()
                    this.clearCurrentTap()
                    this.clearEditingCurrentTap()
                },

                setEditFlagsFalse: function() {
                    this.editTitle = false
                    this.editDescription = false
                    this.editUrlLabel = false
                },

            },

            created: function() {

            },

            mounted: function() {
                this.csrf_token = document.querySelector("input[name=csrfmiddlewaretoken]").value
                this.loadTaps()
            }
        })
    </script>
</body>
</html>

