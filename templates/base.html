{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Font Awesome -->

    <!-- meta tags store general metadata -->
    {% comment %} https://developer.mozilla.org/en-US/docs/Web/HTML/Element#document_metadata {% endcomment %}
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Get our favorite font. -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,300;0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">

    <!-- Get our favicon. -->

    <!-- Import external css -->
    <!-- 'normalize css first' -->
    <link rel="stylesheet" type="text/css" href="https://necolas.github.io/normalize.css/8.0.1/normalize.css" />
    <!-- Import external css -->
    <!-- Specify our css -->
    {% comment %} <link rel="stylesheet" type="text/css" href="/static/css/style.css" />     {% endcomment %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}" />

    <!-- Page title, the text that appears on a browser. -->
    <title>{% block title %}Technology and Perceptibility{% endblock %}</title>

    <style></style>

</head>
<body class="wrapper">
    {% csrf_token %}
    
    <div class="full-width-header">
        <header>
            <a href="#app" title="Skip to main content">Skip to main content</a>
            <div class="page-title">
                <h1>TAP - Accessibility in Action</h1>
                
            </div>
            <nav>
                <p><a href="{% url 'home' %}">Home</a></p>
                <p><a href="#">Our Values</a></p>
                <address>
                    <a href="mailto:Bruce.Stull@gmail.com">Bruce.Stull@gmail.com</a><br>
                    <a href="https://brucestull.com/" target="_blank">brucestull.com</a>
                </address>
            </nav>
        </header>
    </div>
    <main class="page-body">
        {% block content %}
        {% endblock %}
    </main>
    <footer class="page-footer">
        <p>Flynnt Knapp 2022</p>
        <p><a href="{% url 'home' %}">Home</a></p>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script>
        const vm = new Vue({
            el: '#app',
            delimiters: ['[[',']]'],
            data: {

                testTaps: [
                    {
                        id: 1,
                        title: 'An, 1, unoriginal title?',
                        description: 'An, 1, unoriginal description!'
                    },
                    {
                        id: 2,
                        title: 'An, 2, unoriginal title?',
                        description: 'An, 2, unoriginal description!'
                    },
                ],

                taps: [],

                currentTap: {},

                csrf_token: "",
            },

            methods: {
                loadTaps: function() {
                    console.log("Attempting to load TAPs")
                    axios({
                        method: 'get',
                        url: `/api/v1/taps/`,
                    }).then(response => {
                        console.log(`response: `, response)
                        console.log(`response.data: `, response.data)
                        for (let i = 0; i < response.data.length; i++) {
                            this.taps.push(response.data[i])
                            this.taps[i].localBrowsableApiUrl = `/api/v1/taps/${this.taps[i].id}/`
                            this.taps[i].localBrowsableApiUrlDescription = `Browsable API link to this TAP with id of ${this.taps[i].id}.`
                        }
                        console.log(`this.taps`, this.taps)
                        this.clearCurrentTap()
                    }).catch(error => {
                        console.log(`error.response.data`, error.response.data)
                    })
                },

                clearTaps: function() {
                    this.taps = []
                },

                loadSingleTap: function(tap) {
                    console.log(`Attempting to load a single TAP: ${ tap.id }`)
                    axios({
                        method: 'get',
                        url: `/api/v1/taps/${ tap.id }`,
                    }).then(response => {
                        console.log(`response: `, response)
                        console.log(`response.data: `, response.data)
                        this.currentTap = response.data

                        this.currentTap.localBrowsableApiUrl = `/api/v1/taps/${ this.currentTap.id }/`
                        this.currentTap.localBrowsableApiUrlDescription = `Browsable API link to this TAP with id of ${ this.currentTap.id }.`

                        console.log(`currentTap: `, this.currentTap)
                        console.log(`currentTap.id: `, this.currentTap.id)
                        console.log(`currentTap.title: `, this.currentTap.title)
                        this.clearTaps()
                    }).catch(error => {
                        // console.log(`error.response.data`, error.response.data)
                        console.log(`error`, error)
                        console.log(`error.response`, error.response)
                    })
                },

                clearCurrentTap: function() {
                    this.currentTap = {}
                },

            },

            created: function() {

            },

            mounted: function() {
                this.csrf_token = document.querySelector("input[name=csrfmiddlewaretoken]").value
                this.loadTaps()
            }
        })
    </script>
</body>
</html>

